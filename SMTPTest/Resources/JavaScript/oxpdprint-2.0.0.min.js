!function(a,b){"use strict";function c(a){var b,c="",d=a.length;for(b=0;d>b;b+=1)c+=a.charCodeAt(b).toString(16);return c}function d(a){var b=Number(a).toString(16);return b="00000000"+b,b.slice(-8)}function e(a){var b=Number(a).toString(16);return b="0000"+b,b.slice(-4)}function f(a){var b,c="",d=a.length;for(b=0;d>b;b+=2)c+=String.fromCharCode(parseInt(a.substr(b,2),16));return c}function g(a){return parseInt(a,16)}function h(b,c){return 0===b.status?new a.Error(a.ErrorName.AjaxError,"Connection failed"):404===b.status?new a.Error(a.ErrorName.NotFound,"Requested resource not found"):500===b.status?new a.Error(a.ErrorName.ServerError,"Internal Server Error"):"parsererror"===c?new a.Error(a.ErrorName.AjaxError,"Parse Failed"):"timeout"===c?new a.Error(a.ErrorName.AjaxError,"Timeout"):"abort"===c?new a.Error(a.ErrorName.AjaxError,"Aborted"):new a.Error(a.ErrorName.Unknown,"Unknown Error: "+b.responseText)}function i(b){switch(b){case"0000":case"0001":case"0002":break;case"0400":throw new a.Error(a.ErrorName.BadRequest,"Client Error: Bad Request");case"0402":throw new a.Error(a.ErrorName.NotAuthenticated,"Client Error: Not Authenticated");case"0403":throw new a.Error(a.ErrorName.NotAuthorized,"Client Error: Not Authorized");case"0404":throw new a.Error(a.ErrorName.NotPossible,"Client Error: Not Possible");case"0406":throw new a.Error(a.ErrorName.NotFound,"Client Error: Not Found");case"0409":throw new a.Error(a.ErrorName.ParamTooLong,"Client Error: Parameter Too Long");case"040C":throw new a.Error(a.ErrorName.UnsupportedUri,"Client Error: Unsupported Uri");case"0412":throw new a.Error(a.ErrorName.UnreachableUri,"Client Error: Unreachable Uri");case"0507":throw new a.Error(a.ErrorName.Busy,"Server Error: Busy");default:throw new a.Error(a.ErrorName.Unknown,"Error: Unknown")}}function j(b,f){var g;if(void 0===f.documentUri||null===f.documentUri||"string"!=typeof f.documentUri||f.documentUri.length<1)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.documentUri");g=f.documentUri;var h=f.userName;if(void 0===f.userName||null===f.userName)h=null;else{if("string"!=typeof f.userName||f.userName.length<1)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.userName");h=f.userName}var i;if(void 0===f.password||null===f.password)i=null;else{if("string"!=typeof f.password||f.password.length<1)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.password");i=f.password}var j;if(void 0===f.cookie||null===f.cookie)j=null;else{if("string"!=typeof f.cookie||f.cookie.length<1||f.cookie.length>4092)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.cookie");j=f.cookie}var k;if(void 0===f.copies||null===f.copies)k=1;else{if(!("number"==typeof f.copies&&f.copies>0&&f.copies<1e3))throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.copies");k=f.copies}var m="one-sided";if(void 0===f.plexMode||null===f.plexMode||f.plexMode===a.PlexMode.Simplex)m="one-sided";else if(f.plexMode===a.PlexMode.DuplexLongEdge)m="two-sided-long-edge";else{if(f.plexMode!==a.PlexMode.DuplexShortEdge)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.PlexMode");m="two-sided-short-edge"}var n;if(void 0===f.colorMode||null===f.colorMode||f.colorMode===a.ColorMode.Auto)n="auto";else if(f.colorMode===a.ColorMode.Color)n="color";else{if(f.colorMode!==a.ColorMode.Monochrome)throw new a.Error(a.ErrorName.BadRequest,"Invalid printTicket.colorMode");n="monochrome"}var o=Math.floor(65535*Math.random()+1),p="";null!==h&&(p="4100137072696E742D7572692D757365722D6E616D65"+e(h.length)+c(h));var q="";null!==i&&(q="4100127072696E742D7572692D70617373776F7264"+e(i.length)+c(i));var r="";if(void 0!==b&&null!==b){if("string"!=typeof b||b.length<1)throw new a.Error(a.ErrorName.BadRequest,"Invalid uiContextId");r="41001A7072696F726974792D7072696E742D617574682D636F6F6B6965"+e(b.length)+c(b)}var s,t,u,v,w="";null!==j&&(s=j.substr(0,1023),t=j.substr(1023,1023),u=j.substr(2046,1023),v=j.substr(3069,1023),w="4100107072696E742D7572692D636F6F6B6965"+e(s.length)+c(s),void 0!==t&&null!==t&&t.length>0&&(w=w+"410000"+e(t.length)+c(t)),void 0!==u&&null!==u&&u.length>0&&(w=w+"410000"+e(u.length)+c(u)),void 0!==v&&null!==v&&v.length>0&&(w=w+"410000"+e(v.length)+c(v)));var x="02210006636F706965730004"+d(k)+"44001A6D756C7469706C652D646F63756D656E742D68616E646C696E67002273657061726174652D646F63756D656E74732D636F6C6C617465642D636F706965734400057369646573"+e(m.length)+c(m)+"4400107072696e742d636f6c6f722d6d6f6465"+e(n.length)+c(n),y="02000003"+d(o)+l+"45000C646F63756D656E742D757269"+e(g.length)+c(g)+p+q+r+w+x+"03";return y}var k=null,l="01470012617474726962757465732D6368617273657400057574662D3848001B617474726962757465732D6E61747572616C2D6C616E67756167650005656E2D757345000B7072696E7465722D7572690010687474703A2F2F3132372E302E302E31",m="4400147265717565737465642D6174747269627574657300167072696E7465722D6D616B652D616E642D6D6F64656C440000000D7072696E7465722D737461746544000000157072696E7465722D73746174652D726561736F6E73440000000F636F6C6F722D737570706F727465644400000019646F63756D656E742D666F726D61742D737570706F72746564440000000F73696465732D737570706F72746564",n="4400147265717565737465642D6174747269627574657300096A6F622D737461746544000000116A6F622D73746174652D726561736F6E7344000000196A6F622D646F63756D656E742D6163636573732D6572726F72",o=function(a,b){this.name=a,this.value=b},p=function(b){if(this.printerAttributes=null,this.jobAttributes=null,8>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");var c=b.substr(4,4);i(c);for(var d,e,f,h,j,k,l=16,m=[];;){if(l+2>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");if(d=b.substr(l,2),l+=2,"03"===d)break;if(l+2>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");for(e=b.substr(l,2);g(e)>15;){if(l+=2,l+4>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");if(f=g(b.substr(l,4)),l+=4,0!==f){if(l+2*f>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");h=b.substr(l,2*f),l+=2*f}if(l+4>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");if(j=g(b.substr(l,4)),l+=4,l+2*j>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");if(k=b.substr(l,2*j),l+=2*j,m.push(new o(h,k)),l+2>b.length)throw new a.Error(a.ErrorName.Unknown,"Error parsing response");e=g(b.substr(l,2))}"04"===d?this.printerAttributes=m:"02"===d&&(this.jobAttributes=m)}};p.prototype.GetMakeAndModel=function(){var b,c=this.printerAttributes.length;for(b=0;c>b;b+=1)if("7072696E7465722D6D616B652D616E642D6D6F64656C"===this.printerAttributes[b].name)return f(this.printerAttributes[b].value);throw new a.Error(a.ErrorName.Unknown,"Error: Device did not provide a make and model")},p.prototype.GetPrinterState=function(){var b,c=this.printerAttributes.length;for(b=0;c>b;b+=1)if("7072696E7465722D7374617465"===this.printerAttributes[b].name)switch(this.printerAttributes[b].value){case"00000003":return a.PrinterState.Idle;case"00000004":return a.PrinterState.Processing;case"00000005":return a.PrinterState.Stopped;default:return a.PrinterState.Unknown}throw new a.Error(a.ErrorName.Unknown,"Error: Device did not provide a printer state")},p.prototype.GetPrinterStateReasons=function(){var a,b=0,c=[],d=this.printerAttributes.length;for(a=0;d>a;a+=1)"7072696E7465722D73746174652D726561736F6E73"===this.printerAttributes[a].name&&(c[b]=f(this.printerAttributes[a].value),b+=1);return c.length>0?c:null},p.prototype.GetColorSupported=function(){var a,b=this.printerAttributes.length;for(a=0;b>a;a+=1)if("636F6C6F722D737570706F72746564"===this.printerAttributes[a].name)return"01"===this.printerAttributes[a].value;return!1},p.prototype.GetSupportedFileTypes=function(){var b,c,d=0,e=[],f=this.printerAttributes.length;for(b=0;f>b;b+=1)if(c=this.printerAttributes[b],"646F63756D656E742D666F726D61742D737570706F72746564"===c.name)switch(c.value){case"696D6167652F6A706567":e[d]=a.FileType.Jpeg,d+=1;break;case"6170706C69636174696F6E2F766E642E68702D50434C":e[d]=a.FileType.PCL5,d+=1;break;case"6170706C69636174696F6E2F766E642E68702D50434C584C":e[d]=a.FileType.PCL6,d+=1;break;case"6170706C69636174696F6E2F706F7374736372697074":e[d]=a.FileType.PS,d+=1;break;case"6170706C69636174696F6E2F706466":e[d]=a.FileType.PDF,d+=1;break;case"746578742F706C61696E":e[d]=a.FileType.Text,d+=1;break;case"696D6167652F74696666":e[d]=a.FileType.Tiff,d+=1}if(e.length>0)return e;throw new a.Error(a.ErrorName.Unknown,"Error: Device did not provide any SupportedFileTypes")},p.prototype.GetSupportedPlexModes=function(){var b,c,d=0,e=[],f=this.printerAttributes.length;for(b=0;f>b;b+=1)if(c=this.printerAttributes[b],"73696465732D737570706F72746564"===c.name)switch(c.value){case"6F6E652D7369646564":e[d]=a.PlexMode.Simplex,d+=1;break;case"74776F2D73696465642D6C6F6E672D65646765":e[d]=a.PlexMode.DuplexLongEdge,d+=1;break;case"74776F2D73696465642D73686F72742D65646765":e[d]=a.PlexMode.DuplexShortEdge,d+=1}if(e.length>0)return e;throw new a.Error(a.ErrorName.Unknown,"Error: Device did not provide any PlexModes")},p.prototype.GetJobId=function(){var b,c=this.jobAttributes.length;for(b=0;c>b;b+=1)if("6A6F622D6964"===this.jobAttributes[b].name)return g(this.jobAttributes[b].value);throw new a.Error(a.ErrorName.Unknown,"Error: Device did not provide a jobId")},p.prototype.GetJobState=function(){var b,c=a.JobState.Unknown,d=this.jobAttributes.length;for(b=0;d>b;b+=1)if("6A6F622D7374617465"===this.jobAttributes[b].name){switch(this.jobAttributes[b].value){case"00000008":c=a.JobState.Aborted;break;case"00000003":c=a.JobState.Pending;break;case"00000004":c=a.JobState.PendingHeld;break;case"00000005":c=a.JobState.Processing;break;case"00000006":c=a.JobState.ProcessingStopped;break;case"00000009":c=a.JobState.Completed;break;case"00000007":c=a.JobState.Canceled;break;default:c=a.JobState.Unknown}break}return c},p.prototype.GetJobStateReasons=function(){var a,b=0,c=[],d=this.jobAttributes.length;for(a=0;d>a;a+=1)"6A6F622D73746174652D726561736F6E73"===this.jobAttributes[a].name&&(c[b]=f(this.jobAttributes[a].value),b+=1);return c.length>0?c:null},p.prototype.GetJobDocumentAccessError=function(){var a,b=this.jobAttributes.length;for(a=0;b>a;a+=1)if("6A6F622D646F63756D656E742D6163636573732D6572726F72"===this.jobAttributes[a].name)return f(this.jobAttributes[a].value);return null},a.ErrorName={NotSetup:"NotSetup",ServiceNotFound:"ServiceNotFound",AjaxError:"AjaxError",BadRequest:"BadRequest",ServerError:"ServerError",Busy:"Busy",NotAuthenticated:"NotAuthenticated",NotAuthorized:"NotAuthorized",NotFound:"NotFound",NotPossible:"NotPossible",ParamTooLong:"ParamTooLong",UnsupportedUri:"UnsupportedUri",UnreachableUri:"UnreachableUri",Unknown:"Unknown"},a.PrinterState={Idle:"Idle",Processing:"Processing",Stopped:"Stopped",Unknown:"Unknown"},a.ColorMode={Auto:"Auto",Color:"Color",Monochrome:"Monochrome"},a.PlexMode={Simplex:"Simplex",DuplexLongEdge:"DuplexLongEdge",DuplexShortEdge:"DuplexShortEdge"},a.FileType={Jpeg:"Jpeg",PCL5:"PCL5",PCL6:"PCL6",PS:"PS",PDF:"PDF",Text:"Text",Tiff:"Tiff"},a.JobState={Aborted:"Aborted",Pending:"Pending",PendingHeld:"PendingHeld",Processing:"Processing",ProcessingStopped:"ProcessingStopped",Completed:"Completed",Canceled:"Canceled",Unknown:"Unknown"},a.Setup=function(b,c){if(!b)throw new a.Error(a.ErrorName.ServiceNotFound,"OXPd:Print is not supported on the device");var d="https://localhost";void 0!==c&&null!==c&&c.length>0&&(d="https://"+c);var e=b.GetDiscoveredFeatureByResourceTypeAndRevision("pwg:hpIPPPrint-Hex","http://www.pwg.org/ipp/2.0");if(!e)throw new a.Error(a.ErrorName.ServiceNotFound,"OXPd:Print is not supported on the device");k=d+e.resourceURI},a.Error=function(a,b){this.name=a,this.message=b},a.Error.prototype=new Error,a.Error.prototype.constructor=a.Error,a.PrinterAttributes=function(b){if(void 0===b.printerAttributes||null===b.printerAttributes)throw new a.Error(a.ErrorName.Unknown,"Device did not return printer attributes");var c=b.GetMakeAndModel(),d=b.GetPrinterState(),e=b.GetPrinterStateReasons(),f=b.GetSupportedFileTypes(),g=b.GetSupportedPlexModes(),h=[],i=b.GetColorSupported();i===!0?(h[0]=a.ColorMode.Auto,h[1]=a.ColorMode.Color,h[2]=a.ColorMode.Monochrome):(h[0]=a.ColorMode.Auto,h[1]=a.ColorMode.Monochrome),this.makeAndModel=c,this.printerState=d,this.printerStateReasons=e,this.isColorSupported=i,this.supportedFileTypes=f,this.supportedColorModes=h,this.supportedPlexModes=g},a.GetPrinterAttributes=function(){if(null===k){var c=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(c)}var e=Math.floor(65535*Math.random()+1),f="0200000B"+d(e)+l+m+"03";return b.ajax({url:k,type:"POST",dataType:"text",data:f,contentType:"application/ipp"}).then(function(c){return b.Deferred(function(b){try{var d=new p(c),e=new a.PrinterAttributes(d);b.resolve(e)}catch(f){return b.reject(f)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.PrintTicket=function(a,b,c,d,e,f,g,h){this.documentUri=a,this.userName=b,this.password=c,this.cookie=d,this.copies=e,this.plexMode=f,this.colorMode=g},a.PrintUri=function(c){if(null===k){var d=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(d)}var e="";try{e=j(null,c)}catch(d){return b.Deferred().reject(d)}return b.ajax({url:k,type:"POST",dataType:"text",data:e,contentType:"application/ipp"}).then(function(a){return b.Deferred(function(b){try{var c=new p(a),d=c.GetJobId();b.resolve(d)}catch(e){return b.reject(e)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.PriorityPrintUri=function(c,d){if(null===k){var e=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(e)}if(void 0===c||null===c){var e=new a.Error(a.ErrorName.BadRequest,"Invalid uiContextId");return b.Deferred().reject(e)}var f="";try{f=j(c,d)}catch(e){return b.Deferred().reject(e)}return b.ajax({url:k,type:"POST",dataType:"text",data:f,contentType:"application/ipp"}).then(function(a){return b.Deferred(function(b){try{var c=new p(a),d=c.GetJobId();b.resolve(d)}catch(e){return b.reject(e)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.JobAttributes=function(a){this.jobState=a.GetJobState(),this.jobStateReasons=a.GetJobStateReasons(),this.documentAccessError=a.GetJobDocumentAccessError()},a.GetJobAttributes=function(c){if(null===k){var e=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(e)}if(void 0===c||null===c||"number"!=typeof c||1>c||c>4294967295){var e=new a.Error(a.ErrorName.BadRequest,"Invalid jobId");return b.Deferred().reject(e)}var f=Math.floor(65535*Math.random()+1),g="02000009"+d(f)+l+"2100066A6F622D69640004"+d(c)+n+"03";return b.ajax({url:k,type:"POST",dataType:"text",data:g,contentType:"application/ipp"}).then(function(c){return b.Deferred(function(b){try{var d=new p(c),e=new a.JobAttributes(d);b.resolve(e)}catch(f){return b.reject(f)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.CancelJob=function(c){if(null===k){var e=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(e)}if(void 0===c||null===c||"number"!=typeof c||1>c||c>4294967295){var e=new a.Error(a.ErrorName.BadRequest,"Invalid jobId");return b.Deferred().reject(e)}var f=Math.floor(65535*Math.random()+1),g="02000008"+d(f)+l+"2100066A6F622D69640004"+d(c)+"03";return b.ajax({url:k,type:"POST",dataType:"text",data:g,contentType:"application/ipp"}).then(function(a){return b.Deferred(function(b){try{new p(a);b.resolve()}catch(c){return b.reject(c)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.PriorityPrintEnter=function(f){if(null===k){var g=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(g)}if(void 0===f||null===f||"string"!=typeof f||f.length<1){var g=new a.Error(a.ErrorName.BadRequest,"Invalid uiContextId");return b.Deferred().reject(g)}var i=Math.floor(65535*Math.random()+1),j="02004029"+d(i)+l+"41001A7072696F726974792D7072696E742D617574682D636F6F6B6965"+e(f.length)+c(f)+"03";return b.ajax({url:k,type:"POST",dataType:"text",data:j,contentType:"application/ipp"}).then(function(a){return b.Deferred(function(b){try{new p(a);b.resolve()}catch(c){return b.reject(c)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})},a.PriorityPrintExit=function(f){if(null===k){var g=new a.Error(a.ErrorName.NotSetup,"You must call oxpdprint.Setup first");return b.Deferred().reject(g)}if(void 0===f||null===f||"string"!=typeof f||f.length<1){var g=new a.Error(a.ErrorName.BadRequest,"Invalid uiContextId");return b.Deferred().reject(g)}var i=Math.floor(65535*Math.random()+1),j="0200402A"+d(i)+l+"41001A7072696F726974792D7072696E742D617574682D636F6F6B6965"+e(f.length)+c(f)+"03";return b.ajax({url:k,type:"POST",dataType:"text",data:j,contentType:"application/ipp"}).then(function(a){return b.Deferred(function(b){try{new p(a);b.resolve()}catch(c){return b.reject(c)}}).promise()},function(a,c){var d=h(a,c);return b.Deferred().reject(d)})}}(window.oxpdprint=window.oxpdprint||{},jQuery);